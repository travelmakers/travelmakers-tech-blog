{"pageProps":{"post":{"mdxSource":"var Component=(()=>{var d=Object.create;var o=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var r=a=>o(a,\"__esModule\",{value:!0});var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),g=(a,s)=>{r(a);for(var t in s)o(a,t,{get:s[t],enumerable:!0})},k=(a,s,t)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let n of h(s))!u.call(a,n)&&n!==\"default\"&&o(a,n,{get:()=>s[n],enumerable:!(t=p(s,n))||t.enumerable});return a},y=a=>k(r(o(a!=null?d(m(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var l=N((x,i)=>{i.exports=_jsx_runtime});var A={};g(A,{default:()=>v,frontmatter:()=>f});var e=y(l()),f={title:\"Removing sensitive data from the git history\",date:\"2021-09-03\",lastmod:\"2021-09-03\",tags:[\"git\"],draft:!1,summary:\"Its a bad practice to keep sensitive data like password in your repository. How can I remove that from previous commits (git history)?\",authors:[\"default\"]};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({div:\"div\",p:\"p\",code:\"code\",hr:\"hr\",a:\"a\",blockquote:\"blockquote\",pre:\"pre\",span:\"span\",ul:\"ul\",li:\"li\"},a.components),{Image:c}=n;return c||w(\"Image\",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.div,{children:(0,e.jsx)(c,{alt:\"tailwind-nextjs-banner\",src:\"/static/images/yancy-min-code-unsplash.jpg\",width:\"5000\",height:\"3313\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Perhaps you saved sensitive data like a password or a token in your project. From a security point of view, it\\u2019s a bad practice to put them in your code directly and keep them in the repository. For example, the best approach in the Node.js app and other languages is to save sensitive data in the environment variables. So it is kept in a separate file called \",(0,e.jsx)(n.code,{children:\".env\"}),\". Not to be tracked by Git, it is added to \",(0,e.jsx)(n.code,{children:\".gitignore\"}),\". But if you check your previous commits, you will see that sensitive data exists in the git history. So what should be done now?!\"]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[\"You have two options: \",(0,e.jsx)(n.a,{href:\"https://git-scm.com/docs/git-filter-branch\",children:\"Git built-in command\"}),\" \",(0,e.jsx)(n.code,{children:\"git filter-branch\"}),\" or \",(0,e.jsx)(n.a,{href:\"https://rtyley.github.io/bfg-repo-cleaner/\",children:\"BFG Repo-Cleaner tool\"}),\". In this article, I want to show how to use the BFG Repo-Cleaner tool to rewrite your repository\\u2019s history.\"]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"The BFG Repo-Cleaner is a tool that\\u2019s built and maintained by the open-source community. It provides a faster, simpler alternative to \",(0,e.jsx)(n.code,{children:\"git filter-branch\"}),\" for removing unwanted data. (\",(0,e.jsx)(n.a,{href:\"https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository#using-the-bfg\",children:\"GitHub\"}),\")\"]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`mongoose\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"connect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'mongodb+srv://user<password>@cluster0.fzrkd.mongodb.net/myFirstDatabase?retryWrites=true&w=majority'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useNewUrlParser\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useCreateIndex\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useFindAndModify\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useUnifiedTopology\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token console class-name\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DB connection successful!'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The above code is a part of a Node.js app that allows you to connect to the MongoDB Atlas via mongoose driver. For that, you need a connection string that has been bold in that code. That connection string is a sample of sensitive data.\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"At first, create a file \",(0,e.jsx)(n.code,{children:\".env\"}),\".local to save your connection string in a variable called \",(0,e.jsx)(n.code,{children:\"DATABASE\"}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`DATABASE=mongodb+srv://user<password>@cluster0.fzrkd.mongodb.net/myFirstDatabase?retryWrites=true&w=majority\n`})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Then replace that connection string with the one in \",(0,e.jsx)(n.code,{children:\".env.local\"}),\" as \",(0,e.jsx)(n.code,{children:\"process.env.DATABASE\"}),\" in your code like below:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line\",children:`mongoose\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"connect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"DATABASE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useNewUrlParser\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useCreateIndex\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useFindAndModify\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"false\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token literal-property property\",children:\"useUnifiedTopology\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"true\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"then\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token console class-name\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'DB connection successful!'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"In Node.js, you can access environment variables through \",(0,e.jsx)(n.code,{children:\"process\"}),\".\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"You will commit the changes, although previous ones show the connection string right in the code. To replace that connection string with \",(0,e.jsx)(n.code,{children:\"process.env.DATABASE\"}),\" the rest of the commits should be followed by these instructions:\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"If in a macOS, you can use Homebrew to install the BFG Repo-Cleaner tool: \",(0,e.jsx)(n.code,{children:\"brew install bfg\"}),\" and if in Windows, use Chocolatey: \",(0,e.jsx)(n.code,{children:\"choco install bfg-repo-cleaner\"}),\" or download its jar file from their \",(0,e.jsx)(n.a,{href:\"https://rtyley.github.io/bfg-repo-cleaner/\",children:\"site\"}),\".\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Replace the sensitive data with the one you want, then commit your changes. Don\\u2019t forget this step. In this case, replace \",(0,e.jsx)(n.code,{children:\"mongodb+srv://user<password>@cluster0.fzrkd.mongodb.net/myFirstDatabase?retryWrites=true&w=majority\"}),\" with \",(0,e.jsx)(n.code,{children:\"process.env.DATABASE\"}),\".\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"Create a text file (e.x. \",(0,e.jsx)(n.code,{children:\"replacements.txt\"}),\") to the substitutions. According to \",(0,e.jsx)(n.a,{href:\"https://stackoverflow.com/a/15730571/7515532\",children:\"Tyle answered in StackOverflow\"}),\", in this case, the text file contains:\"]}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`DATABASE=mongodb+srv://user<password>@cluster0.fzrkd.mongodb.net/myFirstDatabase?retryWrites=true&w=majority==>process.env.DATABASE\n`})})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"Then run the below code from your project folder. If you installed BFG through its jar file from their site, replace the \",(0,e.jsx)(n.code,{children:\"bfg\"}),\" command with \",(0,e.jsx)(n.code,{children:\"java -jar bfg.jar\"}),\".\"]}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`bfg --replace-text replacements.txt\n`})})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"After getting the \\u201CBFG run is complete!\\u201D message, run this code:\"}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"code-highlight\",children:(0,e.jsx)(n.span,{className:\"code-line\",children:`git reflog expire --expire=now --all && git gc --prune=now --aggressive\n`})})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Now check your previous commits, and you will see the replacements overall in the repository.\"}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[\"If you like this article, you can support me by \\u2615\\uFE0F \",(0,e.jsx)(n.a,{href:\"https://www.buymeacoffee.com/luckydevboy\",children:\"buying a coffee\"}),\" \\u2615\\uFE0F and motivating me to publish more articles.\"]})]})}}var v=b;function w(a,s){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\")}return A;})();\n;return Component;","toc":[],"frontMatter":{"readingTime":{"text":"4 min read","minutes":3.56,"time":213600,"words":712},"slug":"removing-sensitive-data-from-git","fileName":"removing-sensitive-data-from-git.mdx","title":"Removing sensitive data from the git history","date":"2021-09-03T00:00:00.000Z","lastmod":"2021-09-03","tags":["git"],"draft":false,"summary":"Its a bad practice to keep sensitive data like password in your repository. How can I remove that from previous commits (git history)?","authors":["default"]}},"authorDetails":[{"readingTime":{"text":"2 min read","minutes":1.03,"time":61800,"words":206},"slug":["default"],"fileName":"default.md","name":"Travelmakers","avatar":"/static/images/avatar.png","occupation":"트래블메이커스","company":null,"email":"apply@travelmakers.kr","github":"https://github.com/travelmakers","date":null}],"prev":null,"next":{"title":"What are Snippets in VSCode?","date":"2021-11-08T00:00:00.000Z","lastmod":"2021-11-08","tags":["vscode","snippet","react","typescript"],"draft":false,"summary":"Code snippets are templates that make it easier to enter repeating code patterns, such as loops or conditional-statements.","authors":["default"],"slug":"vscode-snippets"}},"__N_SSG":true}